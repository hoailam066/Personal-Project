//using System;
//using System.Collections.Generic;
//using System.Linq;
//using System.Text;
//using System.Threading.Tasks;

//namespace Meter.Library
//{
//    public class CTcpProtocol
//    {
//        public void SentCmd(ref string StrCmd )
//        {
            
//        }
//    }
//    public class CTrimSys
//    {
//        private CTcpProtocol m_TcpProtocol;
//        private string m_CmdSent;
//        private string m_Sts;
//        public CTrimSys()
//        {
//           m_TcpProtocol = new  CTcpProtocol();
//            m_CmdSent="";
//            m_Sts="";
//        }
//        public void Mark1()
//        {
//            while(m_CmdSent != "")
//            { }
//            m_Sts="";
//            m_CmdSent = "Mark1";
//            while(m_CmdSent != "")
//            { }
//            while(m_Sts == "")
//            { }
//        }
//        public void Mark2()
//        {
//            while(m_CmdSent != "")
//            { }
//            m_Sts="";
//            m_CmdSent = "Mark2";
//            while(m_CmdSent != "")
//            { }
//            while(m_Sts == "")
//            { }
//        }

//        public void UpdateResPos(ref float[] XPos, ref float[] YPos)
//        {
//            while(m_CmdSent != "")
//            { }
//            m_Sts="";
//            m_CmdSent = "UpdateResPos";
//            while(m_CmdSent != "")
//            { }
//            while(m_Sts == "")
//            { }

//            for (int i = 1; i <= XPos.Length; i++)
//            {
//                float X_Pos = XPos[i - 1];
//                float Y_Pos = YPos[i - 1];

//                CRes Res = Shared_Data.JTrim.ResistorList.ElementAt(i - 1);
//                Res.Galvo_X_Pos = X_Pos;
//                Res.Galvo_Y_Pos = Y_Pos;
//            }

//            string sErr = "";
//            sErr = Shared_Data.JTrim.Dnld_Res_GalvoX(-1);
//            if (sErr == "")
//            {
//                sErr = Shared_Data.JTrim.Dnld_Res_GalvoY(-1);
//                if (sErr != "")
//                {
//                    throw new Exception(sErr);
//                }
//            }

//        }
//        public void CalculateMode4Pos(ref float[] XPos, ref float[] YPos)
//        {
//            while(m_CmdSent != "")
//            { }
//            m_Sts="";
//            m_CmdSent = "CalculateMode4Pos";
//            while(m_CmdSent != "")
//            { }
//            while(m_Sts == "")
//            { }
//        }


//        public int TotalResistor()
//        {
//            while(m_CmdSent != "")
//            { }
//            m_Sts="";
//            m_CmdSent = "TotalResistor";
//            while(m_CmdSent != "")
//            { }
//            while(m_Sts == "")
//            { }

                 
//        }
//        public int CurrentResID()
//        {
//                while(m_CmdSent != "")
//            { }
//            m_Sts="";
//            m_CmdSent = "CurrentResID";
//            while(m_CmdSent != "")
//            { }
//            while(m_Sts == "")
//            { }
//        }

//        public float GetGalvoPosX()
//        {
//                while(m_CmdSent != "")
//            { }
//            m_Sts="";
//            m_CmdSent = "GetGalvoPosX";
//            while(m_CmdSent != "")
//            { }
//            while(m_Sts == "")
//            { }
//        }

//        public float GetGalvoPosY()
//        {
//            while(m_CmdSent != "")
//            { }
//            m_Sts="";
//            m_CmdSent = "GetGalvoPosX";
//            while(m_CmdSent != "")
//            { }
//            while(m_Sts == "")
//            { }
//        }

//        public int TotalCuts { get; set; }

//        public CRes RES { get; set; }

//        public void PulseLaser()
//        {
//            string sErr = "";

//            //while(true)
//            // {
//            // sErr = Shared_Data.JTrim.TurnLaserOn();
//            // sErr = Shared_Data.JTrim.TurnLaserOff();
//            //  }

//            sErr = Shared_Data.JTrim.PulseLaser();
//            if (sErr != "")
//            {
//                throw new Exception(sErr);
//            }
//        }
//        public void TurnLaserOff()
//        {
//            string sErr = "";

//            //while(true)
//            // {
//            //sErr = Shared_Data.JTrim.TurnLaserOn();
//            sErr = Shared_Data.JTrim.TurnLaserOff();
//            //  }

//            //sErr = Shared_Data.JTrim.PulseLaser();
//            if (sErr != "")
//            {
//                throw new Exception(sErr);
//            }
//        }
//        public void TurnLaserOn()
//        {
//            string sErr = "";

//            //while(true)
//            // {
//            sErr = Shared_Data.JTrim.TurnLaserOn();
//            // sErr = Shared_Data.JTrim.TurnLaserOff();
//            //  }

//            //sErr = Shared_Data.JTrim.PulseLaser();
//            if (sErr != "")
//            {
//                throw new Exception(sErr);
//            }
//        }

//        public void ProbSetting(ref ProbeParam[] Data)
//        {
//            for (int i = 0; i < Data.Length; i++)
//            {
//                CRes res = Shared_Data.JTrim.GetResistor(i + 1);
//                if (res != null)
//                {
//                    res.HF = Data[i].HF;
//                    res.HS = Data[i].HS;
//                    res.LF = Data[i].LF;
//                    res.LS = Data[i].LS;
//                    res.GF = Data[i].GF;
//                    res.GS = Data[i].GS;
//                    res.ID = Data[i].ID;
//                    res.Is2T_Measurement = Data[i].Is2T_Measurement;
//                }
//                else
//                {
//                    Data[i].HF = Data[i].HF; ;
//                }

//            }
//            string sErr = "";
//            sErr = Shared_Data.JTrim.Dnld_Res_ProbeMap(-1);
//        }

//        public void MeasureAll(ref MeasureData[] Data)
//        {
//            string sErr = "";
//            sErr = Shared_Data.JTrim.MeasureAll();
//            if (sErr == "")
//            {
//                sErr = Shared_Data.JTrim.GetMeasureAllColumnResult();
//                if (sErr == "")
//                {
//                    for (int aryIdx = 0; aryIdx < Data.Length; aryIdx++)
//                    {
//                        Data[aryIdx].Pre_Val = Shared_Data.JTrim.TrimmedDataList.ElementAt(aryIdx).Pre_Val;
//                        Data[aryIdx].Pre_Percent = Shared_Data.JTrim.TrimmedDataList.ElementAt(aryIdx).Pre_Percent;
//                        Data[aryIdx].Post_Val = Shared_Data.JTrim.TrimmedDataList.ElementAt(aryIdx).Post_Val;
//                        Data[aryIdx].Post_Percent = Shared_Data.JTrim.TrimmedDataList.ElementAt(aryIdx).Post_Percent;
//                    }
//                }
//            }
//        }

//        public void TrimAll(ref MeasureData[] Data)
//        {
//            string sErr = "";
//            sErr = Shared_Data.JTrim.TrimAll();
//            if (sErr == "")
//            {
//                sErr = Shared_Data.JTrim.GetTrimAllColumnResult();
//                if (sErr == "")
//                {
//                    for (int aryIdx = 0; aryIdx < Data.Length; aryIdx++)
//                    {
//                        Data[aryIdx].Pre_Val = Shared_Data.JTrim.TrimmedDataList.ElementAt(aryIdx).Pre_Val;
//                        Data[aryIdx].Pre_Percent = Shared_Data.JTrim.TrimmedDataList.ElementAt(aryIdx).Pre_Percent;
//                        Data[aryIdx].Post_Val = Shared_Data.JTrim.TrimmedDataList.ElementAt(aryIdx).Post_Val;
//                        Data[aryIdx].Post_Percent = Shared_Data.JTrim.TrimmedDataList.ElementAt(aryIdx).Post_Percent;
//                    }
//                }
//                else
//                {
//                    throw new Exception(sErr);
//                }
//            }
//            else
//            {
//                throw new Exception(sErr);
//            }
//        }

//        public void UpdatePower(float power)
//        {


//            Shared_Data.JTrim.Set_Power = power;
//        }

//        public void GalvoRelMove(bool bXMove, float fRelStep, float GlobalOffsetX, float GlobalOffsetY)
//        {
//            string sErr = "";
//            sErr = Shared_Data.JTrim.GalvoRelMove(bXMove, fRelStep, GlobalOffsetX, GlobalOffsetY);
//            if (sErr != "")
//            {
//                throw new Exception(sErr);
//            }
//        }


//        public void GalvoAbsMove(float XPos, float YPos)
//        {
//            string sErr = "";
//            sErr = Shared_Data.JTrim.GalvoAbsMove(XPos, YPos);
//            if (sErr != "")
//            {
//                throw new Exception(sErr);
//            }
//        }
//        public void GoToResistor(int Res_ID)
//        {
//            if (Res_ID < 1)
//            {
//                Res_ID = 1;
//            }
//            if (Res_ID > Shared_Data.JTrim.TotalResistor)
//            {
//                Res_ID = Shared_Data.JTrim.TotalResistor;
//            }

//            string sErr = "";
//            sErr = Shared_Data.JTrim.GoToResistor(Res_ID);
//            if (sErr != "")
//            {
//                throw new Exception(sErr);
//            }
//        }
//        public float GetPower()
//        {

//            return Shared_Data.JTrim.Set_Power;
//        }

//        public void TrimOne(ref MeasureData[] Data)
//        {
//            string sErr = "";
//            sErr = Shared_Data.JTrim.TrimOne(Shared_Data.JTrim.Current_Res_ID - 1);
//            if (sErr == "")
//            {
//                sErr = Shared_Data.JTrim.GetTrimAllColumnResult();
//                if (sErr == "")
//                {
//                    Data[Shared_Data.JTrim.Current_Res_ID - 1].Pre_Val = Shared_Data.JTrim.TrimmedDataList.ElementAt(Shared_Data.JTrim.Current_Res_ID - 1).Pre_Val;
//                    Data[Shared_Data.JTrim.Current_Res_ID - 1].Pre_Percent = Shared_Data.JTrim.TrimmedDataList.ElementAt(Shared_Data.JTrim.Current_Res_ID - 1).Pre_Percent;
//                    Data[Shared_Data.JTrim.Current_Res_ID - 1].Post_Val = Shared_Data.JTrim.TrimmedDataList.ElementAt(Shared_Data.JTrim.Current_Res_ID - 1).Post_Val;
//                    Data[Shared_Data.JTrim.Current_Res_ID - 1].Post_Percent = Shared_Data.JTrim.TrimmedDataList.ElementAt(Shared_Data.JTrim.Current_Res_ID - 1).Post_Percent;
//                }
//                else
//                {
//                    throw new Exception(sErr);
//                }
//            }
//            else
//            {
//                throw new Exception(sErr);
//            }
//        }

//        public void MeasureSetting(ref float[] Data)
//        {
//            string sErr = "";

//            int totalres = (int)Data[0];
//            //Shared_Data.JTrim.TotalResistor = (int)Data[0];// numResistorRowNumber.Value;
//            Shared_Data.JTrim.MasterResistor.Nominal = (int)Data[1];// numTargetR.Value;
//            Shared_Data.JTrim.MasterResistor.PT_Cnt = (int)Data[2];// numPTSamples.Value;
//            Shared_Data.JTrim.MasterResistor.PT_Dly = (int)Data[3]; //numPTDelay.Value;
//            Shared_Data.JTrim.MasterResistor.PT_High = Data[4];// (float)numPTHigh.Value;
//            Shared_Data.JTrim.MasterResistor.PT_Low = Data[5];// (float)numPTLow.Value;
//            Shared_Data.JTrim.MasterResistor.FT_Cnt = (int)Data[6];// numFTSamples.Value;
//            Shared_Data.JTrim.MasterResistor.FT_Dly = (int)Data[7];// numFTDelay.Value;
//            Shared_Data.JTrim.MasterResistor.FT_High = Data[8];// (float)numFTHigh.Value;
//            Shared_Data.JTrim.MasterResistor.FT_Low = Data[9];// (float)numFTLow.Value;
//            sErr = Shared_Data.JTrim.CopyMasterResistorInfo();
//            if (sErr != "")
//            {
//                throw new Exception(sErr);
//            }
//            else
//            {
//                try
//                {
//                    if (totalres != Shared_Data.JTrim.TotalResistor)
//                    {
//                        Shared_Data.JTrim.TotalResistor = totalres;
//                        for (int i = 1; i < Shared_Data.JTrim.TotalResistor + 1; i++)
//                        {
//                            Shared_Data.JTrim.Dnld_Res_ProbeMap(i);
//                        }
//                    }

//                    sErr = Shared_Data.JTrim.Dnld_Res_Nominal(-1);
//                    if (sErr != "") { throw new Exception(sErr); }

//                    sErr = Shared_Data.JTrim.Dnld_Res_PT_Cnt(-1);
//                    if (sErr != "") { throw new Exception(sErr); }

//                    sErr = Shared_Data.JTrim.Dnld_Res_PT_Dly(-1);
//                    if (sErr != "") { throw new Exception(sErr); }

//                    sErr = Shared_Data.JTrim.Dnld_Res_PT_High(-1);
//                    if (sErr != "") { throw new Exception(sErr); }

//                    sErr = Shared_Data.JTrim.Dnld_Res_PT_Low(-1);
//                    if (sErr != "") { throw new Exception(sErr); }

//                    sErr = Shared_Data.JTrim.Dnld_Res_FT_High(-1);
//                    if (sErr != "") { throw new Exception(sErr); }

//                    sErr = Shared_Data.JTrim.Dnld_Res_FT_Low(-1);
//                    if (sErr != "") { throw new Exception(sErr); }

//                    sErr = Shared_Data.JTrim.Dnld_Res_FT_Cnt(-1);
//                    if (sErr != "") { throw new Exception(sErr); }

//                    sErr = Shared_Data.JTrim.Dnld_Res_FT_Dly(-1);
//                    if (sErr != "") { throw new Exception(sErr); }

//                    //sErr = Shared_Data.JTrim.DownloadPowerFile("D:\\DataSettings\\LaserTrimming1610\\Machine\\LaserPower\\Watts.Sys");


//                }
//                catch (Exception)
//                {

//                }

//            }
//        }

//        public void CutSetting(ref CCutParam[] Data)
//        {
//            // 傳輸格式: 命令,矩陣長度, CMode,CutID,Delay,Direction,Length,PMode,PulseDensity,QRate,Repo,Speed,StopPercent,XOffset,YOffset
//            while (m_CmdSent != "")
//            { }
//            m_Sts = "";
//            m_CmdSent = "CutSetting,"+Data.Length.ToString()+",";
//            for(int i=0 ; i< Data.Length; i++)
//            {
//                m_CmdSent=m_CmdSent+Data[i].CMode+","+Data[i].CutID.ToString()+","+Data[i].Delay.ToString()+","+Data[i].Direction.ToString()+","+Data[i].Length.ToString()+","+Data[i].PMode.ToArray()+","+Data[i].PulseDensity.ToString()+","+Data[i].QRate.ToString()+","+Data[i].Repo.ToString()+","+Data[i].Speed.ToString()+","+Data[i].StopPercent+","+Data[i].XOffset.ToString()+","+Data[i].YOffset;
//            }
//            m_TcpProtocol.SentCmd(ref m_CmdSent);
             
//        }
//        public string Initial()
//        {
//            // CRes RES;
//            // RES.FT_Cnt = 0;

//            bool noError = false;
//            string sErr = "";

//            //Shared_Data.JTrim.TrimType.CutInfoList.ElementAt(0).Direction

//            JTSettings.Present_DIO_Card = true;  //bypass hardware.
//            Shared_Data.JTrim.TotalResistor = 96;
//            JTSettings.Scale_Factor_X = 3.0835164834f;
//            JTSettings.Scale_Factor_Y = 3.0835164834f;
//            Shared_Data.JTrim.TrimType.TotalCuts = 2;
//            JTSettings.DebugOn = 0;  //1 is enable and 0 is disable

//            noError = Shared_Data.JTrim.InitComm();
//            if (noError)
//            {
//                sErr = Shared_Data.JTrim.Initialize();
//                if (sErr == "")
//                {

//                    sErr = Shared_Data.JTrim.Dnld_AllResInfo_And_AllCutInfo();
//                    if (sErr == "")
//                    {
//                        sErr = Shared_Data.JTrim.GoToResistor(1);
//                        if (sErr == "")
//                        {
//                            //GalvoAbsMove(0, 0);
//                            //sErr = Shared_Data.JTrim.DownloadPowerFile("D:\\DataSettings\\LaserTrimming1610\\Machine\\LaserPower\\Watts.Sys");

//                            JTSettings.Pulse_Rate = 200;  //Set QRate for PowerTest, unit (KHz)

//                            //sErr = Shared_Data.JTrim.TurnLaserOn(); //Laser On
//                            //sErr = Shared_Data.JTrim.TurnLaserOff();
//                            return "";
//                        }
//                        else
//                        {
//                            return sErr;
//                        }
//                    }
//                    else
//                    {
//                        return sErr;
//                    }

//                }
//                else
//                {
//                    return sErr;
//                }
//            }
//            else
//            {
//                return "電腦和卡籠連接線鬆脫或是卡籠通訊IC壞掉!";
//            }
//        }
//    }
//}                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             